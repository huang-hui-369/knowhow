#### 用PEAR::Mail 发送邮件

## 前提条件

需要安装 pear Mail，pear Mail_mime

```sh
sudo pear install -a Mail
sudo pear install -a Mail_mime
```

## 发送邮件代码

```php
<?php
// メール送信
require_once 'Mail.php';
require_once("Mail/mime.php");

// 1. 设置发送邮件的参数
$to = "huanghui@grandunit.net,aaa@sample.com";//送信先の指定
$from = 'bbb@sample.com';
$replayTo = 'replay@sample.com';
$cc = 'ccc@sample.com';
$bcc = 'bcc@sample.com';
$subject = 'HTMLメールとテキストメール'; //件名 $subject = $_POST["mail_ubject"];
$text    = "e-mailのテストだよ";  // テキスト本文
$html = <<<HTML
   <html>
   <HEAD>
   <META HTTP-EQUIV="content-type" CONTENT="text/html; charset=UTF-8">
   </HEAD>
   <body>
   e-<font color="red">mail</font>のテストだよ<br />
   </body>
   </html>
HTML;

// UTF-8
$subject = mb_encode_mimeheader( $subject, "UTF-8" );

// UTF-8 => JIS
// $original = mb_internal_encoding(); // 这个干什么用
// $subject = mb_convert_encoding( $subject, "ISO-2022-JP", "UTF-8" );
// mb_internal_encoding( "ISO-2022-JP" ); // 这个干什么用
// $subject = mb_encode_mimeheader( $subject, "ISO-2022-JP" );
// mb_internal_encoding( $original ); // 这个干什么用
// $text = mb_convert_encoding( $text, "ISO-2022-JP", "UTF-8" );
// $file = './secret_file.xls'; // application/octet-stream
// $img  = './my_baby.gif'; // image/gif

$crlf = "\n"; // 現在の改行コード

// ヘッダー情報（邮件显示用）
$headers = array(
  "To" => $to,
  "From" => $from,
  "Cc" => $cc,
  "Bcc" => $bcc,
  "Replay-To" => $replayTo,
  "Subject" => $subject 
);

// 2. 设置mime
$mime = new Mail_mime($crlf);

$mime->setTXTBody($text); // 
$mime->setHTMLBody($html);
// $mime->addAttachment($file);
// $mime->addHTMLImage($img, 'image/gif');

// 出力用パラメータ
$build_param = array(
   "html_charset" => "UTF-8",
   "text_charset" => "UTF-8",
   "head_charset" => "UTF-8",
);

$body = $mime->get( $build_param );
$headers = $mime->headers($headers);
 
// 3. 设置smtp server的参数

$params = array(
    "host"     => "smtp.hetemail.jp",
    "port"     => 25,
    "auth"     => true,
    "username" => "test@grandunit.jp",
    "password" => "Grandunit123"
    //    'protocol' => 'SMTP_AUTH',
    //    "debug"    => false
);
// 获取 mail对象
$mail = Mail::factory("smtp", $params);
// $mail =& Mail::factory('mail'); // 使用php设置的mail发送
// 4. 发送邮件
$status = $mail->send($to, $headers, $body); //真正发送邮件的to地址

if( PEAR::isError( $status ) ) {
	echo "send mail error:".$status;
} else {
	echo "send mail suceed.";
}
?>

```

