# スマホアプリで計測される内容

### 通常アプリ起動

* MAU（MonthlyActiveUser）＝月1回以上起動しているユーザ数
* WAU（WeeklyActiveUser）＝週1回以上起動しているユーザ数
* DAU（DailyActiveUser）＝1日にアプリを起動したユーザ数

### インストール後、アップデート後の初回起動

### ページビュー,タップイベント

# Flutterにfirebase_analyticsの導入

## 1. FirebaseのプロジェクトにAndroidアプリを追加する

プロジェクトページの上の方の、[+アプリを追加]をクリックし、プラットフォームでドロイド君を選びます。

1. アプリの登録
![](img\2021-06-07-17-46-25.png)

![](img\2021-06-07-17-46-41.png)

Package情報を入力する。

![](img\2021-06-07-17-57-45.png)


2. 設定ファイルのダウンロード
play-services.jsonのダウンロード

![](img\2021-06-07-18-00-07.png)

3. Firebase sdkの追加
   
![](img\2021-06-07-18-02-09.png)

## 2. FirebaseのプロジェクトにIOSアプリを追加する

1. アプリの登録
![](img\2021-06-07-18-05-06.png)

![](img\2021-06-07-18-05-26.png)

BudnleIDを入力する。
![](img\2021-06-07-18-06-41.png)

2. 設定ファイルのダウンロード
![](img\2021-06-07-18-08-02.png)

3. Firebase sdkの追加

![](img\2021-06-07-18-09-03.png)

4. 初期化コードの追加

![](img\2021-06-07-18-09-54.png)

## 3. FlutterアプリにFirebaseを設定する

1. pubspec.yamlの設定

```
dependencies:
  flutter:
    sdk: flutter
  flutter_localizations:
    sdk: flutter

    ....

  # Firebase
  firebase_core: ^0.4.4+3
  firebase_analytics: ^8.1.1
```

## 4. 接続を確認する

1. Androidアプリ(debug パッケージ)
    Firebaseプロジェクトページのアプリをクリックし、[SDKの設定を続ける]をクリック
    接続を確認するページまで[次へ]をクリック
    AndroidStudio等から、デバッグ起動する
    接続確認が取れたら、[コンソールへ進む]をクリック
2. Androidアプリ(release 版)
デバッグ用とパッケージ名を分けていない場合は、この手順は不要です。

    Firebaseプロジェクトページのアプリをクリックし、[SDKの設定を続ける]をクリック
    接続を確認するページまで[次へ]をクリック
    flutter build apkでリリースビルドapkを作成する
    上記ビルドapkをエミュレーターなどにインストールして、起動する
    接続確認が取れたら、[コンソールへ進む]をクリック
3. iOSアプリ
    Firebaseプロジェクトページのアプリをクリックし、[SDKの設定を続ける]をクリック
    接続を確認するページまで[次へ]をクリック
    AndroidStudio等から、デバッグ起動する
    接続確認が取れたら、[コンソールへ進む]をクリック

## 5. 接続が確認できないとき
もし、なかなか接続確認してくれないときは、一度アプリをアンインストールして、再起動してみましょう。
それでもだめなときは、OS別に以下の対処を行ってみて下さい。

以下で紹介する方法は、Firebase Analyticsへの送信は通信量やバッテリー負荷などを軽減するためある程度情報が溜まってからまとめて送られているそうなのですが、それをデバッグ用途に逐次送るようにする、という設定です。

この設定がONだと、FirebaseのDebugViewというページで、発生したイベントをほぼリアルタイムで見ることが出来るようになります。

![](img\2021-06-07-18-34-38.png)

1.Android
ターミナルなどで以下のように打ってみて、その後アプリを再起動する。

```
adb shell setprop debug.firebase.analytics.app パッケージ名
```
接続が確認できたら、以下のように打っておいて下さい。

```
adb shell setprop debug.firebase.analytics.app .none.
```
こうしておくと、逐次送る設定が解除されます。

2.iOS
Xcodeのコマンドラインに-FIRDebugEnabledオプションを追加します。

* Xcodeの上の方の、実行ボタンなどの近くにある、[Runner]の部分をクリックします。
    * 私はアプリアイコンを設定済みなので変わってしまっています

![](img\2021-06-07-18-43-12.png)

* [Edit scheme...]を選ぶ

![](img\2021-06-07-18-43-33.png)

Arguments Passed on Launchに-FIRDebugEnabledを入力

![](img\2021-06-07-18-44-06.png)

* [Close]をクリック

これでアプリをXcodeから起動し、接続確認を行ってみて下さい。

一度この設定をした後は、Android Studio等からの起動でも有効になったままになります。

解除するときは、-FIRDebugDisabledを指定して、また一度Xcodeから起動する必要があるようです。

なお、何度この接続確認をやっても、Firebaseのコンソール画面で、赤い○ポチが表示され、[SDKの設定を続ける]が表示されてしまうバグがあるようです。
一度確認できたら、後は無視して良いと思います。
